{"ast":null,"code":"import * as ZXing from \"../third_party/zxing-js.umd\";\nimport { QrcodeResultFormat, Html5QrcodeSupportedFormats } from \"./core\";\nvar ZXingHtml5QrcodeDecoder = function () {\n  function ZXingHtml5QrcodeDecoder(requestedFormats, verbose, logger) {\n    this.formatMap = new Map([[Html5QrcodeSupportedFormats.QR_CODE, ZXing.BarcodeFormat.QR_CODE], [Html5QrcodeSupportedFormats.AZTEC, ZXing.BarcodeFormat.AZTEC], [Html5QrcodeSupportedFormats.CODABAR, ZXing.BarcodeFormat.CODABAR], [Html5QrcodeSupportedFormats.CODE_39, ZXing.BarcodeFormat.CODE_39], [Html5QrcodeSupportedFormats.CODE_93, ZXing.BarcodeFormat.CODE_93], [Html5QrcodeSupportedFormats.CODE_128, ZXing.BarcodeFormat.CODE_128], [Html5QrcodeSupportedFormats.DATA_MATRIX, ZXing.BarcodeFormat.DATA_MATRIX], [Html5QrcodeSupportedFormats.MAXICODE, ZXing.BarcodeFormat.MAXICODE], [Html5QrcodeSupportedFormats.ITF, ZXing.BarcodeFormat.ITF], [Html5QrcodeSupportedFormats.EAN_13, ZXing.BarcodeFormat.EAN_13], [Html5QrcodeSupportedFormats.EAN_8, ZXing.BarcodeFormat.EAN_8], [Html5QrcodeSupportedFormats.PDF_417, ZXing.BarcodeFormat.PDF_417], [Html5QrcodeSupportedFormats.RSS_14, ZXing.BarcodeFormat.RSS_14], [Html5QrcodeSupportedFormats.RSS_EXPANDED, ZXing.BarcodeFormat.RSS_EXPANDED], [Html5QrcodeSupportedFormats.UPC_A, ZXing.BarcodeFormat.UPC_A], [Html5QrcodeSupportedFormats.UPC_E, ZXing.BarcodeFormat.UPC_E], [Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION, ZXing.BarcodeFormat.UPC_EAN_EXTENSION]]);\n    this.reverseFormatMap = this.createReverseFormatMap();\n    if (!ZXing) {\n      throw \"Use html5qrcode.min.js without edit, ZXing not found.\";\n    }\n    this.verbose = verbose;\n    this.logger = logger;\n    var formats = this.createZXingFormats(requestedFormats);\n    var hints = new Map();\n    hints.set(ZXing.DecodeHintType.POSSIBLE_FORMATS, formats);\n    hints.set(ZXing.DecodeHintType.TRY_HARDER, false);\n    this.hints = hints;\n  }\n  ZXingHtml5QrcodeDecoder.prototype.decodeAsync = function (canvas) {\n    var _this = this;\n    return new Promise(function (resolve, reject) {\n      try {\n        resolve(_this.decode(canvas));\n      } catch (error) {\n        reject(error);\n      }\n    });\n  };\n  ZXingHtml5QrcodeDecoder.prototype.decode = function (canvas) {\n    var zxingDecoder = new ZXing.MultiFormatReader(this.verbose, this.hints);\n    var luminanceSource = new ZXing.HTMLCanvasElementLuminanceSource(canvas);\n    var binaryBitmap = new ZXing.BinaryBitmap(new ZXing.HybridBinarizer(luminanceSource));\n    var result = zxingDecoder.decode(binaryBitmap);\n    return {\n      text: result.text,\n      format: QrcodeResultFormat.create(this.toHtml5QrcodeSupportedFormats(result.format)),\n      debugData: this.createDebugData()\n    };\n  };\n  ZXingHtml5QrcodeDecoder.prototype.createReverseFormatMap = function () {\n    var result = new Map();\n    this.formatMap.forEach(function (value, key, _) {\n      result.set(value, key);\n    });\n    return result;\n  };\n  ZXingHtml5QrcodeDecoder.prototype.toHtml5QrcodeSupportedFormats = function (zxingFormat) {\n    if (!this.reverseFormatMap.has(zxingFormat)) {\n      throw \"reverseFormatMap doesn't have \".concat(zxingFormat);\n    }\n    return this.reverseFormatMap.get(zxingFormat);\n  };\n  ZXingHtml5QrcodeDecoder.prototype.createZXingFormats = function (requestedFormats) {\n    var zxingFormats = [];\n    for (var _i = 0, requestedFormats_1 = requestedFormats; _i < requestedFormats_1.length; _i++) {\n      var requestedFormat = requestedFormats_1[_i];\n      if (this.formatMap.has(requestedFormat)) {\n        zxingFormats.push(this.formatMap.get(requestedFormat));\n      } else {\n        this.logger.logError(\"\".concat(requestedFormat, \" is not supported by\") + \"ZXingHtml5QrcodeShim\");\n      }\n    }\n    return zxingFormats;\n  };\n  ZXingHtml5QrcodeDecoder.prototype.createDebugData = function () {\n    return {\n      decoderName: \"zxing-js\"\n    };\n  };\n  return ZXingHtml5QrcodeDecoder;\n}();\nexport { ZXingHtml5QrcodeDecoder };","map":{"version":3,"names":["ZXing","QrcodeResultFormat","Html5QrcodeSupportedFormats","ZXingHtml5QrcodeDecoder","requestedFormats","verbose","logger","formatMap","Map","QR_CODE","BarcodeFormat","AZTEC","CODABAR","CODE_39","CODE_93","CODE_128","DATA_MATRIX","MAXICODE","ITF","EAN_13","EAN_8","PDF_417","RSS_14","RSS_EXPANDED","UPC_A","UPC_E","UPC_EAN_EXTENSION","reverseFormatMap","createReverseFormatMap","formats","createZXingFormats","hints","set","DecodeHintType","POSSIBLE_FORMATS","TRY_HARDER","prototype","decodeAsync","canvas","_this","Promise","resolve","reject","decode","error","zxingDecoder","MultiFormatReader","luminanceSource","HTMLCanvasElementLuminanceSource","binaryBitmap","BinaryBitmap","HybridBinarizer","result","text","format","create","toHtml5QrcodeSupportedFormats","debugData","createDebugData","forEach","value","key","_","zxingFormat","has","concat","get","zxingFormats","_i","requestedFormats_1","length","requestedFormat","push","logError","decoderName"],"sources":["../../src/zxing-html5-qrcode-decoder.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}